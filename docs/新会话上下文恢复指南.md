# 新会话上下文恢复指南

> 当你在新的聊天窗口继续开发时，请将以下资料传输给 AI，以便快速恢复上下文。

---

## 📋 必须传输的核心文档（按优先级）

### 🔴 最高优先级（必须传输）

1. **`docs/ide_任务表.md`**
   - 开发任务清单，包含 P0/P1 所有任务
   - 任务依赖关系、工作量估算
   - **当前进度**：P0 已完成，P1-1 已完成，下一步是 P1-2

2. **`docs/v2_final_plan.md`**
   - **行为规范文档（最高优先级）**
   - 定义 Dry Run、增量处理、目录结构、配置路径等硬规则
   - 所有代码实现必须以此为准

3. **`C:\Users\21027\Desktop\dev_log.md`**
   - 开发日志，记录每日工作进展
   - 重要决策和事件记录
   - **最新日期**：2025-12-10

### 🟡 高优先级（建议传输）

4. **`docs/project_blueprint.md`**
   - 项目蓝图，说明工具目标、使用场景、整体架构

5. **`README.md`**
   - 项目简介和快速开始指南

6. **`docs/acceptance_criteria.md`**
   - 验收标准，用于验证功能是否正确实现

---

## 📁 项目结构概览

```
yt-subtitle-v2/
├── core/              # 核心业务逻辑
│   ├── pipeline.py    # 主流水线
│   ├── detector.py    # 字幕检测
│   ├── downloader.py  # 字幕下载
│   ├── translator.py  # 翻译
│   ├── summarizer.py  # 摘要
│   ├── output.py      # 输出处理
│   ├── llm_client.py  # AI 接口抽象
│   └── ...
├── ui/                # GUI 界面
│   ├── main_window.py      # 主窗口
│   ├── business_logic.py   # 业务逻辑层
│   ├── fonts.py            # 字体配置（22px/18px/14px）
│   ├── components/         # UI 组件
│   └── pages/             # 配置页面
├── config/            # 配置管理
├── docs/              # 文档目录
└── tests/             # 测试文件
```

---

## 🎯 当前开发状态

### ✅ 已完成任务

- **P0-1 ~ P0-25**：CLI 完整流水线 + GUI 完整实现
- **P1-1**：双语字幕输出功能
- **UI 字体统一**：3 种规格（22px/18px/14px）
- **错误处理增强**：实时错误信息显示
- **GUI 稳定性修复**：线程安全问题修复

### 🔄 当前任务

- **下一步**：P1-2 URL 列表模式（CLI + GUI）

### 📝 最近完成的工作（2025-12-10）

- 修复 GUI 线程安全问题（按钮卡死）
- 增强字幕下载错误处理（ffmpeg 回退机制）
- 完善双语字幕生成功能
- 修复错误信息实时显示到 UI
- 统一 UI 字体大小为 3 种规格
- 新增字体配置模块 `ui/fonts.py`

---

## 🔑 关键技术点

### 1. 架构设计
- **LLMClient 抽象接口**：统一 AI 调用层
- **异常系统**：`AppException` + `LLMException`
- **配置管理**：`ConfigManager` + `AppConfig`
- **日志系统**：结构化日志，支持上下文（run_id, task, video_id）

### 2. 核心流程
```
检测 → 下载 → 翻译 → 摘要 → 输出 → 增量更新
```

### 3. GUI 线程安全
- 所有 UI 更新必须通过 `self.after(0, ...)` 回到主线程
- 业务逻辑在后台线程执行，通过回调更新 UI

### 4. 字体规范
- **22px**：页面主标题
- **18px**：工具栏标题、分组标签、占位符文本
- **14px**：侧边栏分组、统计标签、普通标签、状态文本、提示文本、日志内容

---

## 🚨 重要约束和规则

1. **行为规范优先**：`v2_final_plan.md` 是最高优先级，任何实现必须符合此文档
2. **任务顺序**：严格按照 `ide_任务表.md` 中的顺序执行
3. **代码规范**：遵循 `docs/ide_integration.md` 中的 IDE 行为约束
4. **错误处理**：使用统一的异常系统，错误信息必须传递到 UI
5. **线程安全**：GUI 更新必须在主线程执行

---

## 📤 快速传输模板

在新会话中，你可以这样开始：

```
我正在开发 YouTube 字幕工具 v2，请先阅读以下核心文档以恢复上下文：

1. 任务表：docs/ide_任务表.md
2. 行为规范：docs/v2_final_plan.md
3. 开发日志：C:\Users\21027\Desktop\dev_log.md

当前状态：
- P0 已完成，P1-1 已完成
- 下一步任务：P1-2 URL 列表模式
- 最近完成：GUI 稳定性修复、双语字幕完善、UI 字体统一

请先阅读这些文档，然后告诉我下一步应该做什么。
```

---

## 📚 其他参考文档（按需传输）

- `docs/ui_plan.md` - UI 布局细化
- `docs/ide_integration.md` - IDE 行为约束
- `docs/bilingual_subtitle_test_guide.md` - 双语字幕测试指南
- `docs/cookie_setup_guide.md` - Cookie 配置指南
- `docs/AI_PROVIDER_EXTENSION.md` - AI 供应商扩展指南

---

## 💡 提示

- 如果遇到问题，先查看 `dev_log.md` 中是否有类似问题的记录
- 修改核心行为（Dry Run、增量、输出目录等）前，必须先更新 `v2_final_plan.md` 并得到确认
- 所有重要改动都应该在 `dev_log.md` 中记录

