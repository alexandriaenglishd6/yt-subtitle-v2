# YouTube 自动字幕工具 – 验收标准（acceptance_criteria.md）

> 面向对象：用户本人 + 所有 AI / IDE  
> 目的：在「不会写代码」的前提下，依然能有一套清晰、可执行的验收标准，判断每一步开发是不是达标。

---

## 1. 总则：谁说了算？

本项目有 5 份核心文档：

1. `docs/project_blueprint.md` – 项目蓝图：目标、场景、整体架构、UI 骨架  
2. `docs/v2_final_plan.md` – 行为规范：Dry Run / 增量 / 输出结构 / 语言配置 / 并发 & 代理 / 配置路径等“硬规定”  
3. `docs/ide_任务表.md` – 任务拆分：P0 / P1 明确任务顺序与依赖  
4. `docs/ui_plan.md` – UI 规划：布局、页面结构、控件分布  
5. `docs/acceptance_criteria.md` – 本文：**怎么验收每个任务 / 每个阶段**

此外还有：

- `docs/ide_integration.md` – 给 IDE / 开发助手的行为约束（MUST / MUST NOT）

**优先级规则：**

- 行为对不对 → 以 `docs/v2_final_plan.md` 为最终依据  
- 做了没做 / 做到什么程度 → 以 `docs/ide_任务表.md` 为依据  
- 方向架构是否合理 → 参考 `docs/project_blueprint.md`  
- UI 是否符合预期 → 参考 `docs/ui_plan.md`  
- 是否达标 → 按本文的验收标准来确认

> ⚠️ 如需修改行为（Dry Run 语义、增量逻辑、目录结构、LanguageConfig 语义等），必须先更新 `docs/v2_final_plan.md` 和本文件，并经用户确认后，IDE 才能改代码。

---

## 2. 验收维度总览

每个任务 / 里程碑验收时，从 5 个维度看：

1. **功能行为是否正确**（最重要）  
2. **稳定性 / 容错是否达标**  
3. **性能与并发是否在安全范围内**  
4. **国际化 / 语言相关是否符合约定**  
5. **代码质量与可维护性**（由 IDE 自检并解释）

用户本人不需要看懂代码，只需要：

- 按 IDE 给的步骤跑一遍；  
- 检查输出目录、日志、大致行为是否符合文档；  
- 看 IDE 的「自我说明」是不是对得上文档。

---

## 3. 功能行为验收标准（功能对不对）

### 3.1 每个任务的基本要求

当 IDE 完成 `docs/ide_任务表.md` 中任意一个任务（例如 P0-8：Dry Run）时，必须给出：

1. **本次任务对应的文档条目**：
   - 引用 `docs/v2_final_plan.md` 中相关小节（例如「Dry Run 语义」「增量处理」「输出结构」等）；  
   - 引用 `docs/ide_任务表.md` 中当前任务的描述。

2. **行为说明（用中文）**：
   - 「现在实现的行为是：输入 X → 程序做 Y → 输出 Z」；  
   - 明确说明哪些功能已经实现，哪些先用占位 / TODO。

3. **操作步骤（给用户用）**：
   - 明确写出 1～3 条命令或界面操作，例如：
     - `python cli.py channel --url <测试频道URL> --dry-run`  
     - 打开 `out/` 文件夹，看见某些文件 / 子目录  
   - 默认假设用户不会写代码，只能复制命令、点按钮。

4. **预期结果（用户可见）**：
   - 运行以上步骤后，用户应能看到什么：
     - 控制台 / GUI 日志中有哪些关键行；  
     - `out/` 或配置目录下有哪些文件和目录；  
   - IDE 必须写成“对小白友好”的中文说明。

### 3.2 行为正确性判定方式

验收时，用户只需要确认：

- **行为是否符合 `docs/v2_final_plan.md` 的定义**：

  举例：

  - Dry Run（仅检测模式）：  
    - ✅ 只检测字幕，日志中能看到每个视频的字幕情况；  
    - ✅ 任务结束时，日志最后会有一行类似这样的汇总信息：  
      - `本次共检测 1000 个视频：可处理 800 个，无字幕 200 个（仅日志输出，不写任何报告文件）`  
    - ❌ 不能在 Dry Run 模式下下载字幕 / 调用 AI / 写 JSON/HTML 报告 / 更新增量档案。  

  - 增量（频道 / 播放列表 / URL 列表）：  
    - ✅ 第二次对同一频道 / 同一 URL 列表中重复视频进行处理时，只处理“新增或未成功”的视频；  
    - ❌ 不能把上次已经成功处理过的 1000 条再跑一遍。  

  - 输出结构：  
    - ✅ 目录和文件命名符合规范（有 `original.*.srt` / `translated.*.srt` / `summary.*.md` / `metadata.json` 等）；  
    - ❌ 不能随意改变目录名、在路径中写“中文/英文”这种自然语言，也不能在 Dry Run 阶段额外生成所谓“检测报告文件”。

---

## 4. 稳定性与容错验收标准

### 4.1 最低稳定性要求

对每个里程碑（尤其是 P0 的几个阶段），要求：

1. **对小频道（3–5 个视频）能稳定跑完，不崩溃**；  
2. **对中等频道 / URL 列表（50–100 个视频）能跑完，即使有部分失败，也不会导致整个程序崩掉**。

### 4.2 错误处理要求

IDE 必须证明：

1. 常见错误时，程序不会直接崩溃退出，而是：  
   - 在日志中输出清晰的错误原因（例如：网络错误 / 403 / 字幕不存在 / AI 超时）；  
   - 在 `out/failed.txt` 中写入失败的视频链接和原因。

2. 提供至少 2 类错误的演示：

   - **人为制造网络错误**：  
     - 例如关掉网络再跑一次小频道；  
     - IDE 说明程序行为：哪些视频失败了，日志和 `failed.txt` 里有什么。  

   - **处理无字幕视频**：  
     - 对一个没有任何可用字幕的视频，IDE 说明：  
       - 程序应如何标记（例如“不处理，仅记录”）；  
       - 是否会导致整体任务失败（不允许）。

3. **关于 `out/failed.txt` 的强制要求：**

   - 所有下载 / 翻译 / 摘要等环节的失败，必须以“追加写入”的方式记录到 `out/failed.txt`；  
   - 每一行至少包含：时间戳、频道/列表标识（如有）、视频 ID 或 URL、简要失败原因；  
   - 示例（仅为示例格式）：  
     - `[2025-12-07 14:32:10] [频道:UCxxxxxx] [视频:dQw4w9WgXcQ] https://... - 原因：网络超时`  
   - 程序**不得**在失败时弹出任何对话框提示用户（例如 MessageBox），所有错误必须通过日志与 `failed.txt` 静默记录。

4. **中断/失败后的“垃圾文件”处理：**

   - 如果某个视频在下载字幕或处理中途失败，留下了 `.part` / `.tmp` / 其他临时文件：  
     - ✅ 验收标准是：任务结束时这些半截文件会被自动清理，不会长期堆在 `out/` 目录；  
     - ❌ 不允许大量 `.part` 文件长期留在输出目录，让用户自己猜哪个是垃圾。


### 4.3 用户验收动作

- 运行 IDE 提供的测试命令 / 点击操作；  
- 检查程序是否在错误场景下：
  - 没有直接闪退；  
  - 日志能看到简明的错误说明；  
  - `out/failed.txt` 被更新。

---

## 5. 性能与并发验收标准

### 5.1 默认配置的安全性

要求：

1. 在**默认配置**下（并发 ~3，代理 0–1 个）：  
   - 跑一个 50～100 视频的小频道或 URL 列表，CPU / 内存占用在合理范围内（IDE 需描述大致情况）；  
   - 无明显 UI 卡死，日志输出流畅。

2. IDE 必须说明：  
   - 并发数默认值（例如 3）；  
   - 推荐范围（例如 3–5）；  
   - 当用户设置超过某个值（如 >10）时，程序会在日志中发出警告，而不是直接硬崩。

### 5.2 扩大规模时的行为

不要求 IDE 在你电脑上实测 1000 个视频，但需要：

1. 至少对一个 **200～300 个视频的频道** 跑一次：  
   - 记录耗时（大概即可）；  
   - 记录是否出现被限流 / 429 等现象；  
   - 日志中是否有重试 / 失败记录。

2. 解释：  
   - YouTube 反爬机制是主要瓶颈；  
   - 增加代理数量和合理并发可以缓解，但不能无限上升；  
   - 程序不会强制锁死并发 / 代理上限，但会通过日志或 UI 提示风险。

---

## 6. 国际化 / 语言相关验收标准

### 6.1 行为层面

要求：

1. **摘要语言可切换**：  
   - 当 `summary_language` 改成英文时：  
     - AI 摘要输出必须为英文；  
     - Prompt 中不能再出现“请用中文总结”之类硬编码中文语句；  
   - IDE 要展示配置修改 + 输出差异。

2. **字幕翻译不写死中文**：  
   - 将 `subtitle_target_languages` 改为 `["en-US"]` 或其他语言时：  
     - 输出的 `translated.<lang>.srt` 对应正确语言；  
     - 不会再强制翻译成中文。  

### 6.2 代码层面（由 IDE 自检）

IDE 必须说明并证明：

1. 在 V2 代码中，不存在如下硬编码逻辑：  
   - `if lang == "zh" ...`；  
   - “翻译成中文” 这样的中文字符串写在业务代码里。  

2. 所有语言相关的决策，都从 `LanguageConfig` 中取得，而不是散落常量。

用户不看代码，只需要让 IDE 示范：

- 在工程中搜索 `"中文"` / `"zh-CN"` 等，IDE 对这些结果进行解释：  
  - 必须说明：  
    - 哪些在配置 / 语言包中（允许）；  
    - 哪些如果出现在业务代码中，是 bug，并改掉。

---

### 6.3 配置文件（config.json）的示例结构

为了避免 IDE 随意设计配置结构，建议在首次实现时遵循如下基本结构（可根据实际增加字段）：

```json
{
  "language": {
    "ui_language": "zh-CN",
    "subtitle_target_languages": ["zh-CN"],
    "summary_language": "zh-CN",
    "bilingual_mode": "none",
    "translation_strategy": "OFFICIAL_AUTO_THEN_AI"
  },
  "concurrency": 3,
  "proxies": [],
  "cookie": "",
  "output_dir": "out",
  "ai": {
    "provider": "openai-or-anthropic-or-xxx",
    "model": "gpt-4.1-mini-or-claude-3-5-or-xxx",
    "api_key_env": "YTSUB_API_KEY"
  }
}
---

## 7. UI 验收标准（对不会写代码的你友好）

### 7.1 布局与交互

要求：

1. UI 基本布局符合蓝图 / `docs/ui_plan.md`：  
   - 顶部工具栏（语言 / 主题 / 打开输出 / 打开配置 / 状态）；  
   - 左侧侧边栏（主流程 / 设置 / 外观 & 系统）；  
   - 中间内容区；  
   - 底部日志框。

2. IDE 必须给一张（或多张）截图 + 文字说明：  
   - 每个区域放了什么控件；  
   - 按钮对应的行为。

### 7.2 可用性

验收时，用户只需要检查：

1. **主流程页面：**  
   - 能输入频道 URL（P0）；  
   - 有“检查新视频”（Dry Run）按钮；  
   - 有“开始处理”按钮；  
   - 日志框中可以看到过程输出。

   > P1 阶段：主流程中还会增加 URL 列表模式入口，届时可按 `docs/ui_plan.md` 再补充验收。

2. **设置页面：**  
   - 能设置并发数、代理列表、Cookie、AI 模型等；  
   - 不常用选项归到二级/高级区域，不挤在主页面。

3. **外观 / 系统页面：**  
   - 可以切换主题；  
   - 可以切换界面语言；  
   - 可以打开输出目录、打开配置目录。

---

## 8. 代码质量与结构验收标准（由 IDE 自查）

你不需要自己审代码，但可以要求 IDE 每个阶段自查，并用中文向你报告。标准包括：

### 8.1 结构与复用

- 相似逻辑不能 copy-paste 多处，必须抽成函数 / 模块：  
  - 例如：检测字幕的逻辑应集中在 `SubtitleDetector`；  
  - 输出目录结构的构造应集中在 `OutputWriter`；  
  - 不允许在 UI 代码中重复写业务逻辑。  

- IDE 需要：  
  - 指出哪些模块是可复用的；  
  - 哪些地方做了抽象（而不是复制）。

### 8.2 函数 / 文件合理大小（不“一坨屎”）

- 单个函数过长（如超过 100 行），IDE 应主动拆分：  
  - 将明显独立的逻辑拆成子函数；  
  - 使用有意义的函数名提高可读性。  

- 单个文件如果过大（如 500+ 行且承担多种职责），建议拆分。

### 8.3 命名与注释

- 模块 / 类 / 函数命名要能看名字猜大概职责，如：  
  - `VideoFetcher`、`IncrementalManager`、`SubtitleDetector` 等。  
- 关键流程（尤其是 pipeline）要有简明注释。

IDE 要通过示例代码片段 + 简短解释，向你证明这些标准被遵守。

---

## 9. 测试与验收流程

### 9.1 Smoke Test（自动）

- IDE 必须提供：  
  - 一个可运行的 `tests/test_smoke.py` 或脚本；  
  - 一条类似的命令：  
    - `python -m tests.test_smoke`  
  - 说明该脚本会做什么（例如：处理一个内置测试频道或短 URL 列表）。

验收时：

- 你只需要运行这条命令，看到：  
  - 脚本执行成功；  
  - 最终输出“测试通过”或类似信息；  
  - IDE 提前说明 `out/` 里会生成什么。

### 9.2 人工验收（你来点几次）

对于每个阶段结束时的「整体验收」，IDE 需要给你一份“验收步骤清单”，例如：

1. 打开 GUI；  
2. 输入某个测试频道 URL；  
3. 点击【检查新视频】；  
4. 点击【开始处理】；  
5. 打开输出文件夹，检查是否有 X 个视频子目录；  
6. 打开 1～2 个字幕 / 摘要文件，确认语言 / 格式大致正确。

你按这份清单操作即可。

---

## 10. 变更与补充

- 如需新增 / 调整验收标准（例如增加某项安全要求、日志规范等），必须：  
  1. 先更新本文件 `docs/acceptance_criteria.md`；  
  2. 再通知 IDE，所有后续任务按照新标准执行。

- IDE 不得以“实现方便”为理由，自行降低验收标准，必须显式告知并由用户确认后，才允许修改文档和标准。
