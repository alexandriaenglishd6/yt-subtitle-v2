# é«˜å¹¶å‘ç¿»è¯‘ä¼˜åŒ–å®æ–½è®¡åˆ’ï¼ˆå®Œæ•´ç‰ˆï¼‰

## ç›®æ ‡

1. **æ‰¹æ¬¡æµæ°´çº¿ä¼˜åŒ–** - å‡å°‘ç­‰å¾…æ—¶é—´ï¼Œä¸‹è½½å®Œæˆå³å¼€å§‹ç¿»è¯‘
2. **å¤š API Key è½®è¯¢** - æ¯ä¸ªæä¾›å•†æ”¯æŒå¤š Key è´Ÿè½½å‡è¡¡
3. **å¤š AI æä¾›å•†å¹¶è¡Œ** - é€šç”¨ AI + ç¿»è¯‘ä¸“å± AI åŒæ—¶å·¥ä½œ

---

## ä¾›åº”å•†åˆ†ç±»

| ç±»å‹ | ä¾›åº”å•† | ç‰¹ç‚¹ | å¹¶å‘èƒ½åŠ› |
|------|--------|------|----------|
| **é€šç”¨ AI** | OpenAI, Gemini, Kimi, Claude | ç¿»è¯‘+æ‘˜è¦ | é«˜ï¼ˆå¤š Keyï¼‰ |
| **ç¿»è¯‘ä¸“å±** | DeepL, ç™¾åº¦, å¾®è½¯, æœ‰é“, Google | ä»…ç¿»è¯‘ | æé«˜ï¼ˆä¸“ä¸ºç¿»è¯‘ä¼˜åŒ–ï¼‰ |

---

## æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å…¨å±€ç¿»è¯‘ä»»åŠ¡è°ƒåº¦å™¨                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                  é€šç”¨ AI æä¾›å•†                           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â”‚
â”‚  â”‚  â”‚ OpenAI   â”‚  â”‚ Gemini   â”‚  â”‚ Kimi     â”‚               â”‚    â”‚
â”‚  â”‚  â”‚ KeysÃ—3   â”‚  â”‚ KeysÃ—2   â”‚  â”‚ KeysÃ—1   â”‚               â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                ç¿»è¯‘ä¸“å±æä¾›å•†                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ DeepL    â”‚  â”‚ ç™¾åº¦ç¿»è¯‘  â”‚  â”‚ å¾®è½¯ç¿»è¯‘  â”‚  â”‚ Google   â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ KeysÃ—2   â”‚  â”‚ KeysÃ—1   â”‚  â”‚ KeysÃ—1   â”‚  â”‚ å…è´¹     â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                        â†“ ä»»åŠ¡åˆ†å‘                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           ç¿»è¯‘ä»»åŠ¡é˜Ÿåˆ— (10è§†é¢‘ Ã— 32chunk = 320ä»»åŠ¡)        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ–‡ä»¶ç»“æ„

```
core/ai_providers/
â”œâ”€â”€ key_selector.py          [NEW] å¤š Key è½®è¯¢è°ƒåº¦å™¨
â”œâ”€â”€ multi_provider_pool.py   [NEW] å¤šæä¾›å•†çº¿ç¨‹æ± 
â”œâ”€â”€ unified_translate.py     [NEW] ç¿»è¯‘ä¸“å±ä¾›åº”å•†ç»Ÿä¸€å®¢æˆ·ç«¯
â”œâ”€â”€ google_translate.py      [ä¿ç•™] Google å…è´¹ç¿»è¯‘
â””â”€â”€ registry.py              [MODIFY] æ³¨å†Œæ–°ä¾›åº”å•†

config/
â””â”€â”€ manager.py               [MODIFY] å¤š Key é…ç½®ç»“æ„

ui/pages/
â””â”€â”€ translation_settings.py  [MODIFY] å¤šæä¾›å•†/å¤š Key UI
```

---

## æ ¸å¿ƒæ”¹åŠ¨

### æ”¹åŠ¨ 1ï¼šå¤š Key æ•°æ®ç»“æ„

```python
# æ—§ç»“æ„ï¼ˆå• Keyï¼‰
api_keys = {"openai": "sk-xxx"}

# æ–°ç»“æ„ï¼ˆå¤š Keyï¼‰
api_keys = {
    "openai": ["sk-xxx-1", "sk-xxx-2", "sk-xxx-3"],
    "deepl": ["key-1", "key-2"],
    "baidu": ["APPID1:APPKEY1", "APPID2:APPKEY2"]
}
```

### æ”¹åŠ¨ 2ï¼šç¿»è¯‘ä¸“å±ä¾›åº”å•†

| ä¾›åº”å•† | Provider åç§° | Key æ ¼å¼ | å¹¶å‘ç‰¹ç‚¹ |
|--------|--------------|----------|----------|
| DeepL | `deepl` | `DEEPL_API_KEY` | é«˜å¹¶å‘ï¼Œè´¨é‡å¥½ |
| ç™¾åº¦ç¿»è¯‘ | `baidu` | `APPID:APPKEY` | å…è´¹é¢åº¦å¤§ |
| å¾®è½¯ç¿»è¯‘ | `microsoft` | `API_KEY` | ç¨³å®š |
| æœ‰é“ç¿»è¯‘ | `youdao` | `APPID:APPKEY` | ä¸­æ–‡ä¼˜åŒ– |
| Google | `google` | å…è´¹ | æ— é™åˆ¶ |

### æ”¹åŠ¨ 3ï¼šä»»åŠ¡è°ƒåº¦ç­–ç•¥

```python
class TranslationScheduler:
    """æ™ºèƒ½ç¿»è¯‘ä»»åŠ¡è°ƒåº¦å™¨"""
    
    def schedule_chunk(self, chunk: SubtitleChunk) -> Provider:
        # ä¼˜å…ˆçº§: ç¿»è¯‘ä¸“å± > é€šç”¨ AIï¼ˆç¿»è¯‘ä¸“å±æ›´å¿«æ›´ä¾¿å®œï¼‰
        if self.has_available_translate_provider():
            return self.get_best_translate_provider()
        else:
            return self.get_best_ai_provider()
```

---

## é…ç½®ç»“æ„

```json
{
  "translation_config": {
    "translate_providers": {
      "deepl": {
        "enabled": true,
        "api_keys": ["key-1", "key-2"],
        "max_concurrency_per_key": 5
      },
      "baidu": {
        "enabled": true,
        "api_keys": ["APPID:APPKEY"],
        "max_concurrency_per_key": 10
      },
      "google": {
        "enabled": true,
        "max_concurrency": 20
      }
    },
    "ai_providers": {
      "openai": {
        "enabled": true,
        "api_keys": ["sk-1", "sk-2", "sk-3"],
        "max_concurrency_per_key": 3
      },
      "gemini": {
        "enabled": true,
        "api_keys": ["key-1"],
        "max_concurrency_per_key": 5
      }
    },
    "key_strategy": "round_robin",
    "prefer_translate_providers": true
  }
}
```

---

## å¹¶å‘è®¡ç®—ç¤ºä¾‹

```
ç¿»è¯‘ä¸“å±ä¾›åº”å•†:
  DeepL:  2 Keys Ã— 5 å¹¶å‘ = 10
  ç™¾åº¦:   1 Key  Ã— 10 å¹¶å‘ = 10
  Google: å…è´¹    Ã— 20 å¹¶å‘ = 20
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  å°è®¡: 40 å¹¶å‘

é€šç”¨ AI ä¾›åº”å•† (å¤‡ç”¨):
  OpenAI: 3 Keys Ã— 3 å¹¶å‘ = 9
  Gemini: 1 Key  Ã— 5 å¹¶å‘ = 5
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  å°è®¡: 14 å¹¶å‘

æ€»è®¡: 54 å¹¶å‘ç¿»è¯‘ä»»åŠ¡
```

---

## UI è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¿»è¯‘é…ç½®                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Œ ç¿»è¯‘ä¸“å±ä¾›åº”å•†ï¼ˆæ¨èï¼Œé€Ÿåº¦å¿«ï¼Œæˆæœ¬ä½ï¼‰                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ â˜‘ DeepL     [API Keys: key-1, key-2     ] [+] å¹¶å‘: 5  â”‚   â”‚
â”‚ â”‚ â˜‘ ç™¾åº¦ç¿»è¯‘   [APPID:APPKEY              ] [+] å¹¶å‘: 10 â”‚   â”‚
â”‚ â”‚ â˜‘ Google    [å…è´¹ï¼Œæ— éœ€é…ç½®              ]    å¹¶å‘: 20 â”‚   â”‚
â”‚ â”‚ â˜ å¾®è½¯ç¿»è¯‘   [                          ] [+]         â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚ ğŸ¤– é€šç”¨ AI ä¾›åº”å•†ï¼ˆç¿»è¯‘+æ‘˜è¦éƒ½å¯ç”¨ï¼‰                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ â˜‘ OpenAI    [sk-1, sk-2, sk-3           ] [+] å¹¶å‘: 3  â”‚   â”‚
â”‚ â”‚ â˜ Gemini    [                           ] [+]         â”‚   â”‚
â”‚ â”‚ â˜ Kimi      [                           ] [+]         â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚ âš™ï¸ è°ƒåº¦ç­–ç•¥: [è½®è¯¢ â–¼]  â˜‘ ä¼˜å…ˆä½¿ç”¨ç¿»è¯‘ä¸“å±ä¾›åº”å•†                  â”‚
â”‚                                                              â”‚
â”‚ ğŸ’¡ å½“å‰é…ç½®: 5 ä¾›åº”å•†, 8 Keys, æœ€å¤§ 54 å¹¶å‘                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®æ–½é˜¶æ®µ

| é˜¶æ®µ | ä»»åŠ¡ | å·¥ä½œé‡ |
|------|------|--------|
| **P0** | å¤š Key æ•°æ®ç»“æ„ + å‘åå…¼å®¹ | 1h |
| **P0** | KeySelector è½®è¯¢è°ƒåº¦å™¨ | 1h |
| **P1** | ç¿»è¯‘ä¸“å±ä¾›åº”å•†ç»Ÿä¸€å®¢æˆ·ç«¯ | 2.5h |
| **P1** | MultiProviderPool å®ç° | 2h |
| **P2** | UI å¤šæä¾›å•†/å¤š Key é…ç½® | 2h |
| **P2** | ç¿»è¯‘å™¨é›†æˆè°ƒåº¦å™¨ | 1.5h |
| **P3** | æ‰¹æ¬¡æµæ°´çº¿ä¼˜åŒ– | 1h |
| **P3** | æµ‹è¯•éªŒè¯ | 1h |
| **æ€»è®¡** | | **~12h** |

---

## æ•ˆæœé¢„æœŸ

| åœºæ™¯ | ä¹‹å‰ | ä¹‹å |
|------|------|------|
| 10 è§†é¢‘ Ã— 32 chunk | 3 å¹¶å‘, ~3h | 50+ å¹¶å‘, ~15min |
| API æˆæœ¬ | å…¨éƒ¨ç”¨ AI | ç¿»è¯‘ä¸“å±æ›´ä¾¿å®œ |
| å¤±è´¥æ¢å¤ | å•ç‚¹æ•…éšœ | è‡ªåŠ¨åˆ‡æ¢æä¾›å•† |

---

## ä¸æ‘˜è¦çš„å…³ç³»

| åŠŸèƒ½ | å¯ç”¨ä¾›åº”å•† |
|------|-----------|
| ç¿»è¯‘ | ç¿»è¯‘ä¸“å± + é€šç”¨ AI |
| æ‘˜è¦ | ä»…é€šç”¨ AI |

ç¿»è¯‘ä¸“å±ä¾›åº”å•†**ä¸èƒ½ç”¨äºæ‘˜è¦**ï¼ŒUI éœ€è¦è¿‡æ»¤ã€‚

---

## æ‘˜è¦é˜¶æ®µå¹¶å‘ä¼˜åŒ–

### Map-Reduce æ‘˜è¦å¹¶å‘

å½“å‰æ‘˜è¦é‡‡ç”¨ Map-Reduce æ¨¡å¼ï¼š
1. **Map é˜¶æ®µ**ï¼šæ¯ä¸ª chunk ç”Ÿæˆå­æ‘˜è¦ â†’ **å¯å¹¶å‘**
2. **Reduce é˜¶æ®µ**ï¼šåˆå¹¶å­æ‘˜è¦ â†’ éœ€è¦ä¸²è¡Œ

```
ä¹‹å‰ï¼ˆä¸²è¡Œ Mapï¼‰:
  Chunk 1: [æ‘˜è¦] â†’ Chunk 2: [æ‘˜è¦] â†’ Chunk 3: [æ‘˜è¦] â†’ [åˆå¹¶]
  
ä¹‹åï¼ˆå¹¶å‘ Mapï¼‰:
  Chunk 1: [æ‘˜è¦] â”€â”
  Chunk 2: [æ‘˜è¦] â”€â”¼â†’ [åˆå¹¶]
  Chunk 3: [æ‘˜è¦] â”€â”˜
```

### æ‘˜è¦ä¾›åº”å•†

| ä¾›åº”å•† | å¯ç”¨äºç¿»è¯‘ | å¯ç”¨äºæ‘˜è¦ |
|--------|-----------|-----------|
| DeepL/ç™¾åº¦/å¾®è½¯ | âœ… | âŒ |
| OpenAI/Gemini/Kimi | âœ… | âœ… |

### æ‘˜è¦å¹¶å‘é…ç½®

```json
{
  "summary_config": {
    "enabled_providers": ["openai", "gemini"],
    "api_keys": {
      "openai": ["sk-1", "sk-2"],
      "gemini": ["key-1"]
    },
    "max_concurrency_per_key": 3,
    "map_parallel": true  // å¯ç”¨ Map é˜¶æ®µå¹¶å‘
  }
}
```

### å¹¶å‘è®¡ç®—ï¼ˆæ‘˜è¦ï¼‰

```
æ‘˜è¦ Map é˜¶æ®µ:
  OpenAI: 2 Keys Ã— 3 å¹¶å‘ = 6
  Gemini: 1 Key  Ã— 3 å¹¶å‘ = 3
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  æ€»è®¡: 9 å¹¶å‘æ‘˜è¦ï¼ˆMap é˜¶æ®µï¼‰
```

### æ•ˆæœ

| é˜¶æ®µ | ä¹‹å‰ | ä¹‹å |
|------|------|------|
| ç¿»è¯‘ | 3 å¹¶å‘, ~3h | 50+ å¹¶å‘, ~15min |
| æ‘˜è¦ Map | 1 å¹¶å‘, ~2min/chunk | 9 å¹¶å‘, ~15s/chunk |

---

## å®Œæ•´æµæ°´çº¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§†é¢‘ 1: [ä¸‹è½½] â†’ [ç¿»è¯‘: 32 chunks Ã—50å¹¶å‘] â†’ [æ‘˜è¦: MapÃ—9] â†’ [Reduce]
â”‚ è§†é¢‘ 2:    [ä¸‹è½½] â†’ [ç¿»è¯‘: 32 chunks Ã—50å¹¶å‘] â†’ [æ‘˜è¦: MapÃ—9] â†’ [Reduce]
â”‚ è§†é¢‘ 3:       [ä¸‹è½½] â†’ [ç¿»è¯‘: 32 chunks Ã—50å¹¶å‘] â†’ [æ‘˜è¦: MapÃ—9] â†’ ...
â”‚              â†‘ æµæ°´çº¿ï¼Œä¸ç­‰å¾…å‰ä¸€ä¸ªè§†é¢‘å®Œæˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®æ–½é˜¶æ®µï¼ˆæ›´æ–°ï¼‰

| é˜¶æ®µ | ä»»åŠ¡ | å·¥ä½œé‡ |
|------|------|--------|
| **P0** | å¤š Key æ•°æ®ç»“æ„ + å‘åå…¼å®¹ | 1h |
| **P0** | KeySelector è½®è¯¢è°ƒåº¦å™¨ | 1h |
| **P1** | ç¿»è¯‘ä¸“å±ä¾›åº”å•†ç»Ÿä¸€å®¢æˆ·ç«¯ | 2.5h |
| **P1** | MultiProviderPool å®ç° | 2h |
| **P2** | ç¿»è¯‘å™¨é›†æˆå¤šæä¾›å•† | 1.5h |
| **P2** | **æ‘˜è¦ Map é˜¶æ®µå¹¶å‘** | 1h |
| **P3** | UI å¤šæä¾›å•†/å¤š Key é…ç½® | 2h |
| **P3** | æ‰¹æ¬¡æµæ°´çº¿ä¼˜åŒ– | 1h |
| **P4** | æµ‹è¯•éªŒè¯ | 1h |
| **æ€»è®¡** | | **~13h** |

---

## å®¹é”™ä¸æ¢å¤æœºåˆ¶

### é”™è¯¯å¤„ç†ç­–ç•¥

```
ç¿»è¯‘/æ‘˜è¦ä¸­é€”å‡ºé”™:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chunk 11:   âŒ OpenAI Key1 é™æµ (429)                   â”‚
â”‚             â†“                                            â”‚
â”‚             è‡ªåŠ¨åˆ‡æ¢ â†’ OpenAI Key2                       â”‚
â”‚             â†“ ä»å¤±è´¥                                     â”‚
â”‚             è‡ªåŠ¨åˆ‡æ¢ â†’ Gemini                            â”‚
â”‚             â†“ ä»å¤±è´¥                                     â”‚
â”‚             è‡ªåŠ¨åˆ‡æ¢ â†’ DeepL (ä»…ç¿»è¯‘)                    â”‚
â”‚             â†“ æˆåŠŸ âœ…                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸‰çº§å®¹é”™æœºåˆ¶

| çº§åˆ« | ç­–ç•¥ | è¯´æ˜ |
|------|------|------|
| L1 | Key è½®è¯¢ | åŒ Provider æ¢ Key |
| L2 | Provider åˆ‡æ¢ | æ¢å…¶ä»– Provider |
| L3 | æ‹†åˆ†é‡è¯• | ç¼©å° chunk é‡è¯• |

### æ–­ç‚¹ç»­ä¼ 

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| ç¿»è¯‘åˆ†å—æ¢å¤ | âœ… å·²å®ç° | ChunkTracker æŒä¹…åŒ–è¿›åº¦ |
| **æ‘˜è¦åˆ†å—æ¢å¤** | â³ å¾…å®ç° | éœ€è¦æ–°å¢ SummaryChunkTracker |

### æ‘˜è¦åˆ†å—æ¢å¤è®¾è®¡

```python
# æ–°å¢: core/state/summary_tracker.py
class SummaryChunkTracker:
    """æ‘˜è¦åˆ†å—è¿›åº¦è·Ÿè¸ªå™¨"""
    
    def __init__(self, video_id: str, work_dir: Path):
        self.progress_file = work_dir / "summary_progress.json"
        self.chunks_dir = work_dir / "summary_chunks"
    
    def save_chunk_summary(self, chunk_index: int, summary: str):
        """ä¿å­˜å•ä¸ª chunk çš„æ‘˜è¦ç»“æœ"""
        ...
    
    def get_pending_chunks(self) -> list[int]:
        """è·å–å°šæœªå®Œæˆæ‘˜è¦çš„ chunk ç´¢å¼•"""
        ...
    
    def merge_summaries(self) -> str:
        """åˆå¹¶æ‰€æœ‰å·²å®Œæˆçš„ chunk æ‘˜è¦"""
        ...
```

**æ•ˆæœ**ï¼šå¦‚æœæ‘˜è¦åˆ°ä¸€åŠä¸­æ–­ï¼Œé‡å¯åå¯ä»ä¸Šæ¬¡å¤±è´¥çš„ chunk ç»§ç»­ã€‚

---

## é£é™©ä¸ç¼“è§£

| é£é™© | ç¼“è§£æªæ–½ |
|------|----------|
| å‘åå…¼å®¹ | æ—§æ ¼å¼ `str` è‡ªåŠ¨è½¬ `list[str]` |
| API é™æµ | 429 é”™è¯¯æ—¶è‡ªåŠ¨åˆ‡æ¢ Key/Provider |
| é…ç½®å¤æ‚åº¦ | é»˜è®¤å• Keyï¼Œé«˜çº§ç”¨æˆ·å¯å¯ç”¨å¤š Key |
| è¿›åº¦ä¸¢å¤± | ç¿»è¯‘/æ‘˜è¦å‡æŒä¹…åŒ–è¿›åº¦ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼  |

---

## å…¨æµç¨‹é«˜å¹¶å‘è®¾è®¡ï¼ˆ50 çº¿ç¨‹ç›®æ ‡ï¼‰

### è®¾è®¡ç›®æ ‡

- **é«˜æ€§èƒ½**ï¼š50 çº¿ç¨‹å¹¶å‘ï¼Œå¿«é€Ÿå¤„ç†ä»»åŠ¡
- **é«˜ç¨³å®š**ï¼š1000+ è§†é¢‘ï¼Œè¿è¡Œæ•°å°æ—¶ä¸å´©æºƒ
- **æ— ç“¶é¢ˆ**ï¼šå…¨æµç¨‹æ¯ä¸ªé˜¶æ®µéƒ½æ”¯æŒé«˜å¹¶å‘

### å…¨æµç¨‹ç“¶é¢ˆåˆ†æ

| é˜¶æ®µ | å½“å‰å¹¶å‘ | ç“¶é¢ˆ | 2.0 ç›®æ ‡ |
|------|----------|------|----------|
| é“¾æ¥è¯†åˆ« | 5 | YouTube é™æµ | 50ï¼ˆ+ä»£ç†æ± ï¼‰ |
| å­—å¹•ä¸‹è½½ | éšä»»åŠ¡ | yt-dlp é€Ÿåº¦ | 50ï¼ˆ+Cookie è½®æ¢ï¼‰ |
| ç¿»è¯‘ | 3 | AI Key æ•°é‡ | 50+ï¼ˆå¤š Key+å¤š Providerï¼‰ |
| æ‘˜è¦ | 1 | AI Key æ•°é‡ | 20+ï¼ˆå¤š Keyï¼‰ |

### å…¨å±€ä»»åŠ¡è°ƒåº¦æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å…¨å±€ä»»åŠ¡è°ƒåº¦å™¨                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä»»åŠ¡é˜Ÿåˆ—: 1000+ è§†é¢‘                                            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ é“¾æ¥è¯†åˆ«æ±   â”‚ â†’ â”‚ ä¸‹è½½æ±       â”‚ â†’ â”‚ ç¿»è¯‘/æ‘˜è¦æ±   â”‚            â”‚
â”‚  â”‚ 50 workers  â”‚   â”‚ 50 workers  â”‚   â”‚ 50 workers  â”‚            â”‚
â”‚  â”‚ + ä»£ç†æ±     â”‚   â”‚ + Cookie    â”‚   â”‚ + å¤šKey     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                 â”‚
â”‚  æµæ°´çº¿ï¼šè§†é¢‘å®Œæˆä¸€ä¸ªé˜¶æ®µç«‹å³è¿›å…¥ä¸‹ä¸€é˜¶æ®µï¼Œä¸ç­‰å¾…å…¶ä»–è§†é¢‘          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æ–°å¢æ¨¡å— 1ï¼šä»£ç†æ± 

```python
# æ–°å¢: core/proxy_pool.py
class ProxyPool:
    """ä»£ç† IP æ± ï¼Œè§£å†³ YouTube é™æµ"""
    
    def __init__(self, proxies: list[str]):
        self.proxies = proxies
        self.index = 0
        self.lock = threading.Lock()
    
    def get_next(self) -> str:
        """è½®è¯¢è¿”å›ä¸‹ä¸€ä¸ªä»£ç†"""
        with self.lock:
            proxy = self.proxies[self.index % len(self.proxies)]
            self.index += 1
            return proxy
    
    def mark_failed(self, proxy: str):
        """æ ‡è®°ä»£ç†å¤±è´¥ï¼Œä¸´æ—¶ç§»å‡ºæ± """
        ...
```

**æ•ˆæœ**ï¼š50 ä¸ªä»£ç† â†’ 50 å€é“¾æ¥è¯†åˆ«å¹¶å‘

---

### æ–°å¢æ¨¡å— 2ï¼šCookie è½®æ¢

```python
# æ–°å¢: core/cookie_rotator.py
class CookieRotator:
    """Cookie è½®æ¢ï¼Œé¿å…å•è´¦å·é™æµ"""
    
    def __init__(self, cookies: list[Path]):
        self.cookies = cookies
        self.usage_count = {c: 0 for c in cookies}
    
    def get_cookie_for_task(self, task_id: int) -> Path:
        """ä¸ºä»»åŠ¡åˆ†é… Cookieï¼ˆè´Ÿè½½å‡è¡¡ï¼‰"""
        # é€‰æ‹©ä½¿ç”¨æ¬¡æ•°æœ€å°‘çš„ Cookie
        return min(self.usage_count, key=self.usage_count.get)
```

---

### æ–°å¢æ¨¡å— 3ï¼šå…¨å±€ä»»åŠ¡è°ƒåº¦å™¨

```python
# æ–°å¢: core/task_scheduler.py
class GlobalTaskScheduler:
    """å…¨å±€ä»»åŠ¡è°ƒåº¦å™¨ï¼Œç®¡ç†å…¨æµç¨‹"""
    
    def __init__(self, config: HighPerformanceConfig):
        self.detection_pool = ThreadPoolExecutor(max_workers=50)
        self.download_pool = ThreadPoolExecutor(max_workers=50)
        self.translation_pool = ThreadPoolExecutor(max_workers=50)
        
        self.proxy_pool = ProxyPool(config.proxies)
        self.cookie_rotator = CookieRotator(config.cookies)
        self.key_selector = KeySelector(config.api_keys)
    
    def process_video(self, url: str):
        """æµæ°´çº¿å¤„ç†å•ä¸ªè§†é¢‘"""
        # é˜¶æ®µ 1: é“¾æ¥è¯†åˆ«
        video_info = self.detection_pool.submit(detect_with_proxy, url)
        # é˜¶æ®µ 2: å­—å¹•ä¸‹è½½
        subtitle = self.download_pool.submit(download_with_cookie, video_info)
        # é˜¶æ®µ 3: ç¿»è¯‘/æ‘˜è¦
        result = self.translation_pool.submit(translate_with_multi_key, subtitle)
```

---

### æ–°å¢æ¨¡å— 4ï¼šå¥åº·ç›‘æ§

```python
# æ–°å¢: core/health_monitor.py
class HealthMonitor:
    """å¥åº·ç›‘æ§ï¼Œä¿éšœé•¿æ—¶é—´ç¨³å®šè¿è¡Œ"""
    
    def monitor_memory(self):
        """ç›‘æ§å†…å­˜ä½¿ç”¨ï¼Œé˜²æ­¢æº¢å‡º"""
        if psutil.virtual_memory().percent > 80:
            self.trigger_gc()
    
    def monitor_threads(self):
        """ç›‘æ§çº¿ç¨‹å¥åº·çŠ¶æ€"""
        for pool in self.pools:
            if pool.dead_workers > 0:
                pool.restart_workers()
    
    def heartbeat(self):
        """å¿ƒè·³æ£€æµ‹ï¼Œè®°å½•è¿è¡ŒçŠ¶æ€"""
        ...
```

---

### ç¨³å®šæ€§ä¿éšœæœºåˆ¶

| æœºåˆ¶ | è¯´æ˜ |
|------|------|
| **å†…å­˜ç®¡ç†** | å¤§æ‰¹é‡ä»»åŠ¡åˆ†æ‰¹å¤„ç†ï¼Œå®šæœŸ GC |
| **è¿æ¥æ± å¤ç”¨** | HTTP è¿æ¥å¤ç”¨ï¼Œå‡å°‘å¼€é”€ |
| **ä¼˜é›…é™çº§** | å•ä»»åŠ¡å¤±è´¥ä¸å½±å“å…¶ä»–ä»»åŠ¡ |
| **è¿›åº¦æŒä¹…åŒ–** | æ”¯æŒä¸­æ–­åæ¢å¤ |
| **å¿ƒè·³æ£€æµ‹** | ç›‘æ§çº¿ç¨‹å¥åº·çŠ¶æ€ |
| **è‡ªåŠ¨é‡å¯** | æ­»é”/å¡æ­»çº¿ç¨‹è‡ªåŠ¨é‡å¯ |

---

### é…ç½®ç»“æ„

```json
{
  "high_performance_config": {
    "max_concurrent_videos": 50,
    "link_detection": {
      "workers": 50,
      "proxy_pool": ["proxy1:8080", "proxy2:8080", "..."],
      "retry_interval_ms": 1000
    },
    "download": {
      "workers": 50,
      "cookies": ["cookie1.txt", "cookie2.txt", "..."],
      "timeout_seconds": 30
    },
    "translation": {
      "workers": 50,
      "providers": ["openai", "gemini", "deepl", "baidu"],
      "keys_per_provider": 5
    },
    "health_monitor": {
      "memory_threshold_percent": 80,
      "heartbeat_interval_seconds": 60
    }
  }
}
```

---

### æ–°å¢æ¨¡å—å·¥ä½œé‡

| æ¨¡å— | è¯´æ˜ | å·¥ä½œé‡ |
|------|------|--------|
| `core/proxy_pool.py` | ä»£ç†æ± ç®¡ç† | 2h |
| `core/cookie_rotator.py` | Cookie è½®æ¢ | 1h |
| `core/task_scheduler.py` | å…¨å±€ä»»åŠ¡è°ƒåº¦ | 4h |
| `core/health_monitor.py` | å¥åº·ç›‘æ§ | 2h |
| UI é…ç½®ç•Œé¢ | ä»£ç†/Cookie é…ç½® | 2h |
| æµ‹è¯•éªŒè¯ | å‹åŠ›æµ‹è¯• | 2h |
| **æ€»è®¡** | | **~13h** |

---

### å®æ–½é˜¶æ®µï¼ˆæ›´æ–°ï¼‰

| é˜¶æ®µ | ä»»åŠ¡ | å·¥ä½œé‡ |
|------|------|--------|
| **P0** | å¤š Key æ•°æ®ç»“æ„ + å‘åå…¼å®¹ | 1h |
| **P0** | KeySelector è½®è¯¢è°ƒåº¦å™¨ | 1h |
| **P1** | ç¿»è¯‘ä¸“å±ä¾›åº”å•†ç»Ÿä¸€å®¢æˆ·ç«¯ | 2.5h |
| **P1** | MultiProviderPool å®ç° | 2h |
| **P2** | ç¿»è¯‘å™¨é›†æˆå¤šæä¾›å•† | 1.5h |
| **P2** | æ‘˜è¦ Map é˜¶æ®µå¹¶å‘ | 1h |
| **P3** | ä»£ç†æ±  + Cookie è½®æ¢ | 3h |
| **P3** | å…¨å±€ä»»åŠ¡è°ƒåº¦å™¨ | 4h |
| **P4** | å¥åº·ç›‘æ§ | 2h |
| **P4** | UI é…ç½®ç•Œé¢ | 2h |
| **P5** | å‹åŠ›æµ‹è¯• + ä¼˜åŒ– | 3h |
| **P5** | é«˜å¹¶å‘æ—¥å¿—ä¼˜åŒ– | 1h |
| **æ€»è®¡** | | **~24h** |

---

## P5ï¼šé«˜å¹¶å‘æ—¥å¿—ä¼˜åŒ–

### ä¼˜åŒ– 1ï¼šå¼‚æ­¥æ—¥å¿—å†™å…¥

```python
class AsyncLogger:
    """å¼‚æ­¥æ—¥å¿—ï¼Œé¿å… I/O é˜»å¡ä¸»çº¿ç¨‹"""
    
    def __init__(self):
        self.queue = queue.Queue()
        self.writer_thread = Thread(target=self._write_loop)
    
    def log(self, msg):
        self.queue.put(msg)  # éé˜»å¡
    
    def _write_loop(self):
        batch = []
        while True:
            batch.append(self.queue.get())
            if len(batch) >= 50:
                self._flush(batch)  # æ‰¹é‡å†™å…¥
```

### ä¼˜åŒ– 2ï¼šåŠ¨æ€æ—¥å¿—é¢‘ç‡

```python
def get_log_interval(concurrency: int) -> int:
    if concurrency >= 50:
        return 50  # æ¯ 50% è¾“å‡º
    elif concurrency >= 20:
        return 25  # æ¯ 25% è¾“å‡º
    else:
        return 20  # æ¯ 20% è¾“å‡º
```

### ä¼˜åŒ– 3ï¼šèšåˆæ—¥å¿—

```
# é«˜å¹¶å‘æ—¶æ¯ç§’æ±‡æ€»ä¸€æ¬¡
[18:05:00] å®Œæˆ 15/50 è§†é¢‘ | ç¿»è¯‘: 320/1600 chunks | æ‘˜è¦: 45/200 chunks
```

### é…ç½®

```json
{
  "log_config": {
    "mode": "auto",  // auto | detailed | aggregate
    "aggregate_interval_seconds": 5,
    "show_chunk_progress": false,
    "show_video_progress": true
  }
}
```

### åŠ¨æ€æ¨¡å¼

| å¹¶å‘ | æ—¥å¿—æ¨¡å¼ |
|------|----------|
| 1-10 | è¯¦ç»†ï¼ˆæ¯ä¸ª chunkï¼‰ |
| 11-30 | ä¸­ç­‰ï¼ˆæ¯ 25%ï¼‰ |
| 31-50 | ç²¾ç®€ï¼ˆèšåˆæ±‡æ€»ï¼‰ |
