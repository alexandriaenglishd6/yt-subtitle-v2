# UI 规划文档（ui_plan.md）

> 本文定义 YouTube 自动字幕工具的界面布局、主要页面结构和交互规范。  
> 所有 GUI 实现都应遵守本文件，以及：
> - `docs/project_blueprint.md`（项目蓝图：目标与场景）
> - `docs/v2_final_plan.md`（行为规范：Dry Run / 增量 / 输出结构 / 语言配置）
> - `docs/ide_任务表.md`（功能开发顺序）
>
> 本 UI 设计目标：**现代、清爽、实用优先、不牺牲性能**。  
> 整体风格可参考 Clash Verge 的侧边栏布局，但做减法，不搞花里胡哨动画。

---

## 1. 总体布局框架

整体布局采用四区结构：

```text
┌──────────────────────────────────────────────┐
│ 顶部工具栏（全局）                           │
├─────────┬─────────────────────────────────────┤
│ 左侧侧边栏 │ 主内容区（随导航切换）             │
│（导航）    │                                 │
├─────────┴─────────────────────────────────────┤
│ 底部日志框（全局，始终可见）                   │
└──────────────────────────────────────────────┘
1.1 布局要求（MUST）
顶部工具栏

始终可见，不随侧边栏切换而变化（仅内容状态会变化）。

左侧侧边栏

用于页面导航，不放具体表单内容。

至少包含 3 个主入口（详见第 2 节）。

主内容区

根据当前选中的侧边栏入口展示对应页面。

底部日志框

始终可见，不随页面切换隐藏；

用于显示运行日志 / Dry Run 结果 / 错误信息。

整体布局

支持窗口大小变化；

主内容区和日志框之间建议允许拖拽调整高度（非必须，但推荐）。

1.2 视觉风格
扁平化、现代、清爽，避免大量阴影 / 渐变 / 花纹。

控件使用 GUI 框架的标准组件，不自绘复杂皮肤。

不实现复杂动画效果，避免额外性能损耗。

颜色、间距统一由 themes（主题系统）管理，后续根据主题切换。

2. 左侧侧边栏结构（导航）
侧边栏分为三个主分区（从上到下）：

主流程（频繁使用）

运行设置（偶尔调整）

外观 & 系统（很少改）

图示（示意）：

text
复制代码
侧边栏：
[▶ 任务]
    - 频道模式
    - URL 列表模式（P1）

[▶ 运行设置]
    - 运行参数
    - 网络 & AI

[▶ 外观 & 系统]
    - 外观与语言
    - 系统与工具
实现时可以是分组标题 + 简单按钮，不要求真正的树结构，但语义上建议类似上面。

3. 顶部工具栏（全局）
顶部工具栏的职责：放置全局操作和全局状态。

3.1 组件（P0）
从左到右建议包含：

应用标题 + 当前模式指示

文本示例：YouTube 字幕工具 v2 – 频道模式

模式随主内容区选中的页面变化（频道 / URL 列表等）。

当前运行状态

文本显示：空闲 / 处理中 / 暂停（如果未来支持）

可用简单图标 + 文本表示。

右侧功能按钮区域

UI 语言切换下拉（中 / 英）

主题切换入口（弹出菜单选择 4 种主题）

[打开输出文件夹] 按钮

[打开配置文件夹] 按钮

[关于] 或 [帮助]（可选）

3.2 行为要求
顶部工具栏不参与具体业务逻辑，只调统一接口：

打开目录 → 调用系统文件管理器打开 out/ 或配置目录；

切换语言 / 主题 → 调用统一的 i18n / theme 管理器；

不在顶部放与某个页面强耦合的设置（例如并发、代理等）。

4. 主流程页面：频道模式 & URL 列表模式
4.1 频道模式（P0）
侧边栏入口：

[任务] → [频道模式]

主内容区布局示意：

text
复制代码
┌ 频道模式 ──────────────────────────────┐
│ 频道 URL： [_______________________]       │
│ [检查新视频(Dry Run)]  [开始处理]          │
│                                           │
│ 目标字幕语言： [ 下拉 ]                    │
│ 摘要语言：     [ 下拉 ]                    │
│ 双语字幕：     [□ 启用]                    │
│ Dry Run 模式： [□ 只做检测，不下载/不摘要] │
│ 强制重跑：     [□ 忽略历史记录，重新处理]   │
│ （tooltips 简要说明每个选项）              │
│                                           │
│ 统计信息（只读）：                         │
│   - 本次计划处理视频数： N                 │
│   - 已处理： 成功 X / 失败 Y               │
│   - 当前状态： 正在处理第 K 个 / 共 N 个   │
│   - 全局进度条                             │
└───────────────────────────────────────┘
行为要求：

[检查新视频]：

触发 Dry Run（不论底下勾选 Dry Run 与否，可视作“显式 Dry Run 按钮”）；

使用增量：只检测“本次会处理的视频”（默认跳过历史成功）；

不下载、不翻译、不调用 AI、不写文件、不更新增量；

检测结果写入底部日志框。

[开始处理]：

按当前配置跑完整流水线（增量逻辑、生效 / 强制逻辑完全由核心模块决定）；

UI 在顶部状态和统计区域显示进度变化；

底部日志实时输出处理过程。

“Dry Run 模式”复选框：

作为一个“全局只检测”的选项：勾选时，[开始处理] 也只做检测；

即：

显式按钮 [检查新视频] 始终为 Dry Run；

复选框 “Dry Run 模式” 可将 [开始处理] 变成“只检测模式”（给熟练用户用）。

“强制重跑”：

对本次任务输入的所有视频忽略增量，强制重跑（参见 docs/v2_final_plan.md 中增量方案 B）；

具体行为完全交由核心逻辑处理（UI 只设置标志）。

4.2 URL 列表模式（P1）
侧边栏入口：

[任务] → [URL 列表模式]

主内容区布局示意：

text
复制代码
┌ URL 列表模式 ─────────────────────────┐
│ 提示：每行一个视频 URL，可混合频道/列表 │
│ [多行文本框：可粘贴 N 行 URL]          │
│ [检查(可选 Dry Run)]  [开始处理]        │
│                                         │
│ （下方的语言/双语/增量/强制重跑配置     │
│   与频道模式保持一致）                 │
└───────────────────────────────────────┘
行为：

与频道模式类似，只是输入不再是单个频道，而是若干 URL；

语言、双语字幕、Dry Run、强制重跑等配置与频道模式保持一致。

5. 运行设置页面（并发 / 代理 / Cookie / AI 模型）
侧边栏入口：

[运行设置] → [运行参数]

[运行设置] → [网络 & AI]

5.1 运行参数（P0）
包括：

并发数量（输入框）：

默认值：3（从配置载入）；

用户可输入任意正整数，程序内部做基本校验（<= 0 → 重置为 1）；

若用户输入明显偏高值（例如 > 10），在日志提示“并发过高可能导致限流”等。

重试次数（可选，P1）：

下载 / 翻译 / 摘要失败的重试次数（简单整数配置）。

5.2 网络 & AI（P0）
包括：

代理列表：

多行文本框，每行一个代理地址（支持 http / socks5 等）；

数量不在 UI 上限上锁死，但 UI 可提示推荐 1–5 个。

Cookie：

单行输入框或多行文本框；

按钮：[粘贴]（从剪贴板） / [清空]；

[测试] 按钮：

调用一个简单接口检查 Cookie 是否可用；

在底部日志输出检测结果（包括地区信息等）。

AI 模型选择（可放下拉）：

选择当前使用的摘要 / 翻译模型（展示模型名称即可，具体配置可在 config 内部）。

6. 外观 & 系统页面
侧边栏入口：

[外观 & 系统] → [外观与语言]

[外观 & 系统] → [系统与工具]

6.1 外观与语言（P0）
UI 语言选择：

单选：中文 / English；

切换立即生效（可简单重载界面文字）。

主题选择（4 个主题）（P0）：

下拉或几个按钮：

亮色（白）

浅灰

深灰

Claude 暖色

实现通过主题 token（不在这里具体规定颜色值，只在 themes.py 中实现）。

（可选）字体大小设置（P1）：

可在 P1 加入“小 / 中 / 大”，简化处理长日志阅读。

6.2 系统与工具（P0）
[打开输出文件夹]（同顶部按钮，可重复入口）；

[打开配置文件夹]；

显示当前版本号 / 构建信息；

高危操作（需二次确认，P1）：

[重置全部配置]；

[清空某个频道的增量记录]。

7. 底部日志框
底部日志框是全局共享区域。

7.1 功能（P0）
实时展示：

Dry Run 输出（字幕检测结果）；

下载 / 翻译 / 摘要进度信息；

错误信息（包含简要原因）；

提示信息（例如代理 / 并发过高警告）。

行为：

文本自动滚动到最新行（默认）；

可选提供一个“停止自动滚动”的勾选框（P1）。

内容格式建议（非强制）：

text
复制代码
[时间] [级别] [视频ID] 消息
例如：

text
复制代码
[2025-12-07 14:32:10] [INFO] [dQw4w9WgXcQ] 开始检测字幕
[2025-12-07 14:32:11] [WARN] [dQw4w9WgXcQ] 视频无可用字幕
7.2 日志级别过滤（P1）
提供简单选择：

ALL / INFO / WARN / ERROR

默认 ALL。

8. 进度显示设计
8.1 全局进度条（P0）
目的： 在任务执行过程中，直观展示整体处理进度。

数据来源（由 TaskRunner 提供）：

total_videos：本次任务计划处理的视频数量；

completed_videos：已完成数量（成功 + 失败）；

success_count / failure_count：成功 / 失败的数量。

显示内容：

文本区域：

成功：X 失败：Y 总数：N

进度条：

completed_videos / total_videos 对应的百分比。

行为要求：

任务开始时：

总数 N 显示为队列长度（若还在加载列表，可短时间显示“加载中…”）。

每处理完一个视频：

更新 completed_videos、success_count 或 failure_count；

进度条同步刷新。

任务结束时：

进度条为 100%（或 1.0），文字显示完成状态。

不要求：

不要求为每个视频显示单独进度条；

不要求为检测 / 下载 / 翻译 / 摘要各步骤再画次级进度条，详细步骤通过日志展示即可。

8.2 预计剩余时间（ETA）（P1，可选）
P0 阶段不强制实现 ETA。
若未来实现，遵循以下简单规则：

原理：

记录从任务开始到当前完成的耗时；

计算平均单视频耗时 avg_duration；

用 剩余视频数 * avg_duration 估算剩余时间。

显示文案示例：

预计剩余约 18 分钟（仅供参考）

行为限制：

仅在完成一定数量样本（例如 ≥ 10 条）后才开始显示 ETA；

延迟更新频率（例如每 10 秒刷新一次），避免数字乱跳。

9. 性能与交互注意事项
不在 UI 线程中执行长耗时任务：所有下载 / 翻译 / 摘要应在后台线程 / 任务中执行，通过信号 / 回调更新 UI。

日志区域追加文本时，避免每行都强制刷新全窗口（例如使用合理缓冲或批量更新）。

不使用复杂的动画或自定义绘制（如炫酷图表），优先使用标准控件。

10. 实现优先级（UI 部分）
对 IDE / 实现者建议的顺序（与 docs/ide_任务表.md 呼应）：

第一步：

搭建整体布局骨架（顶部工具栏 + 左侧侧边栏 + 主区 + 底部日志框）；

在主流程页面放入基础控件（频道 URL、按钮、简单文本）；

底部日志接入 Logger 输出。

第二步：

将 CLI / 核心流水线接入主流程页面（频道模式）；

实现进度条 + 成功 / 失败计数的更新。

第三步：

实现运行设置页面（并发 / 代理 / Cookie）；

与配置系统绑定。

第四步：

实现外观 & 系统页面（主题、语言、路径操作）；

完成基础 i18n 接入。

第五步（P1）：

URL 列表模式页面；

高级日志视图（过滤、自动滚动开关）；

若需要，添加 ETA 功能。