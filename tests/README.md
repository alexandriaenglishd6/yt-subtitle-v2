# 测试说明

## Smoke Test 使用指南

### 运行方式

```bash
# 方式 1: 直接运行
python tests/test_smoke.py

# 方式 2: 作为模块运行
python -m tests.test_smoke
```

### 测试内容

Smoke Test 会自动验证以下场景：

1. **单视频处理测试**
   - 执行完整的 CLI 流水线（检测 → 下载 → 翻译 → 摘要 → 输出）
   - 验证输出目录结构
   - 验证文件存在性（原始字幕、翻译字幕、摘要、元数据）
   - 验证 metadata.json 内容有效性

2. **Dry Run 模式测试**
   - 执行 Dry Run 命令（仅检测，不下载/不翻译/不摘要）
   - 验证日志输出包含检测信息
   - 验证不生成输出文件

3. **URL 列表模式测试**（可选）
   - 如果配置了测试 URL 列表文件，会测试 URL 列表模式
   - 验证多个视频的输出

### 配置测试参数

编辑 `tests/test_smoke.py` 文件，修改以下变量：

```python
# 测试视频 URL（单视频测试）
TEST_VIDEO_URL = "https://www.youtube.com/watch?v=jNQXAC9IVRw"

# 测试频道 URL（可选，用于频道模式测试）
TEST_CHANNEL_URL = None  # 例如：https://www.youtube.com/@testchannel

# 测试 URL 列表文件（可选，用于 URL 列表模式测试）
TEST_URLS_FILE = None  # 例如：Path("tests/test_urls.txt")
```

### 预期输出

测试成功时，你会看到：

```
============================================================
YouTube 字幕工具 v2 - Smoke Test
============================================================

测试场景 1: 单视频处理
============================================================
✅ CLI 命令执行成功
✅ 输出结构检查通过
✅ 单视频处理测试通过

测试场景 2: Dry Run 模式（仅检测）
============================================================
✅ Dry Run 命令执行成功
✅ Dry Run 测试通过

============================================================
测试结果汇总
============================================================
单视频处理: ✅ 通过
Dry Run: ✅ 通过

总计: 2 通过, 0 失败, 0 跳过

🎉 所有测试通过！
```

### 注意事项

1. **网络要求**：测试需要网络连接和 yt-dlp 可用
2. **时间消耗**：完整测试可能需要几分钟时间
3. **网络问题**：某些测试可能因为网络问题失败，这是正常的
4. **AI 配置**：如果未配置 AI API，翻译和摘要步骤可能会失败，但不会影响整体测试

### 故障排除

如果测试失败：

1. **检查 yt-dlp 是否安装**：
   ```bash
   yt-dlp --version
   ```

2. **检查网络连接**：确保可以访问 YouTube

3. **检查配置**：确保 `config.json` 配置正确（特别是 AI 配置）

4. **查看详细错误**：测试脚本会输出详细的错误信息

